(function(f){"use strict";var t={userStats:{}};var e=function(){return new Promise(function(t,e){f.ajax({method:"GET",url:stopStalkStatsUrl,data:{user_id:userRowID,custom:custom}}).done(function(e){t(e)})})};var a=function(e){f.each(e,function(e,t){f("#"+e.toLowerCase()+"-solved-count").html(t)})};var o=function(e){f.each(e,function(e,t){f("#site-accuracy-"+e.toLowerCase()).html(t)})};function r(){if(linechartAvailable==="True"){i()}c(t.userStats["status_percentages"]);u(t.userStats["calendar_data"]);if(totalSubmissions!=="0"&&isLoggedIn){n(t.userStats["rating_history"])}}function n(e){var t=new google.visualization.DataTable;var a=[["Date","Current Streak","Maximum Streak","Solved","Accuracy","Attempted","Per-Day"]];f.each(e,function(e,t){a.push([new Date(t[0]),t[1][0],t[1][1],t[1][2],t[1][3],t[1][4],t[1][5]])});var o={width:1e3,height:500,legend:{position:"right",maxLines:3},bar:{groupWidth:"100%"},isStacked:true,focusTarget:"category",explorer:{keepInBounds:true,maxZoomOut:1,maxZoomIn:.1}};var r=google.visualization.arrayToDataTable(a);var n=new google.visualization.DataView(r);var i=new google.visualization.ColumnChart(document.getElementById("stopstalk-rating-graph"));i.draw(n,o)}function i(){function d(e){return e<10?"0"+e:e.toString()}function u(e){if(e.search("codechef.com")!==-1){return"codechef"}else if(e.search("codeforces.com")!==-1){return"codeforces"}else if(e.search("hackerrank.com")!==-1){return"hackerrank"}else if(e.search("hackerearth.com")!==-1){return"hackerearth"}else if(e.search("atcoder.jp")!==-1){return"atcoder"}else{f.web2py.flash("Some error occurred");return""}}f.ajax({method:"GET",url:getGraphDataURL,data:{user_id:userRowID,custom:custom}}).done(function(e){var t=e["graphs"];if(t==0){f("#contest_graphs").html("<p>No graph data available at the moment !</p>");return}var n=new google.visualization.DataTable;n.addColumn("date","Day");var i={};var s=Object.keys(t).length;f.each(t,function(r,e){n.addColumn("number",e["title"]);f.each(e["data"],function(e,t){e=e.split(" ")[0];if(i.hasOwnProperty(e)){i[e][r]=[parseFloat(t["rating"]),t]}else{var a=[];for(var o=0;o<s;o++){a.push(null)}a[r]=[parseFloat(t["rating"]),t];i[e]=a}})});var o=[];contestGraphData=jQuery.extend(true,{},i);f.each(i,function(e,a){f.each(a,function(e,t){if(t){a[e]=a[e][0]}});a.unshift(new Date(e));o.push(a)});o.sort(function(e,t){return e[0].getTime()-t[0].getTime()});n.addRows(o);var a={curveType:"function",width:900,height:500,interpolateNulls:true,aggregationTarget:"multiple",focusTarget:"datum",tooltip:{trigger:"selection",isHtml:true},pointSize:4,explorer:{keepInBounds:true,maxZoomOut:1.45,maxZoomIn:.45}};var l=new google.visualization.LineChart(document.getElementById("cumulative_graph"));l.draw(n,a);function r(e){if(typeof ga!=="undefined"){ga("send",{hitType:"event",eventCategory:"button",eventAction:"click",eventLabel:"Contest Graph data point"})}var t=l.getSelection();if(t.length===0||t[0].row===null)return;var a=n.getValue(t[0].row,0);var o=[a.getFullYear(),d(a.getMonth()+1),d(a.getDate())].join("-");f("#contest-activity-date").html(o);var r="";f.each(contestGraphData[o],function(e,t){if(t){r+="<tr><td>"+t[1]["name"]+"</td><td><img src='/stopstalk/static/images/"+u(t[1]["url"])+"_small.png' style=\"height: 30px; width: 30px;\"></img></td><td><a class='popup-contest-page btn-floating btn-small accent-4 green' href='"+t[1]["url"]+"' target='_blank'><i class='fa fa-external-link-square fa-lg'></i></a></td><td>"+t[0]+"</td><td>"+t[1]["rank"]+"</td></tr>"}});f("#participated-contests").html(r);f("#contest-activity-modal").modal({complete:function(){f("#participated-contests").html("")}});f("#contest-activity-modal").modal("open")}google.visualization.events.addListener(l,"select",r)})}function l(e){f("html, body").animate({scrollTop:f("#"+e).offset().top},"slow")}function p(e,t){var a=Object.assign({},t);delete a["count"];var o="<div style='min-width: 180px;'><h6>"+e+"</h6><div style='padding-right: 5px; display: inline;'>";f.each(a,function(e,t){o+="<div class='chip'><img src='/static/images/"+e+"-icon.jpg'></img>"+t+"</div> "});o+="<div></div></div></div>";return o}function h(e){if(onlyGreen){return e.count}var t=e.AC,a=e.PS,o=e.EAC;if(t===undefined)t=0;if(a===undefined)a=0;if(o===undefined)o=0;return 2*(t+a+o)-e.count}function s(e){var t=e.getSelection();var a=t[0]["date"];if(a){var o=new Date(a);var r=o.getFullYear().toString();var n=(o.getMonth()+1).toString();var i=o.getDate().toString();var s=r+"-"+(n[1]?n:"0"+n[0])+"-"+(i[1]?i:"0"+i[0]);f.ajax({url:getActivityURL,data:{date:s,user_id:userRowID,custom:custom},method:"POST"}).done(function(e){f("#activity").html(e["table"]);f(".tooltipped").tooltip({});l("activity")})}}function d(t,r){var e=new google.visualization.DataTable,a=[],o=new Set,n;e.addColumn({type:"date",id:"Date"});e.addColumn({type:"number",id:"Number"});e.addColumn({type:"string",role:"tooltip",p:{html:true}});f.each(r,function(e,t){n=e.split("-");o.add(n[0]);a.push([new Date(n[0],--n[1],n[2]),h(t),p(e,t)])});e.addRows(a);var i,s,l={minValue:1,colors:["#dae7ab","#d6e685","#8cc665","#44a340","#005200","#001A00"],values:[0,4,8,12,16,20]},d={colors:["#CA1717","#FFFFFF","#27CE05"],values:[-5,0,5],maxValue:5,minValue:-5},u="Contribution Graph",c="Acceptance Graph";if(onlyGreen){s=u;i=l}else{s=c;i=d}o=Array.from(o).map(function(e){return parseInt(e)});var m={legend:"none",tooltip:{isHtml:true},title:s,colorAxis:i,noDataPattern:{backgroundColor:"#eeeeee",color:"#eeeeee"},height:36+(Math.max.apply(null,o)-Math.min.apply(null,o)+1)*144,width:920,calendar:{monthOutlineColor:{stroke:"#ffffff",strokeWidth:2},unusedMonthOutlineColor:{stroke:"#ffffff",strokeWidth:2},focusedCellColor:{stroke:"grey",strokeOpacity:.8,strokeWidth:1}}};t.draw(e,m);f("#toggle-submission-graph").on("click",function(){onlyGreen=!onlyGreen;if(onlyGreen){s=u;i=l}else{s=c;i=d}m["colorAxis"]=i;m["title"]=s;var e=new google.visualization.DataTable,a=[],o;e.addColumn({type:"date",id:"Date"});e.addColumn({type:"number",id:"Number"});e.addColumn({type:"string",role:"tooltip",p:{html:true}});f.each(r,function(e,t){o=e.split("-");a.push([new Date(o[0],--o[1],o[2]),h(t),p(e,t)])});e.addRows(a);t.draw(e,m)})}function u(e){var t=new google.visualization.Calendar(document.getElementById("calendar_submission"));google.visualization.events.addListener(t,"select",function(){s(t)});d(t,e)}function c(t){var a={AC:0,WA:0,TLE:0,MLE:0,CE:0,RE:0,SK:0,PS:0,HCK:0,OTH:0};f.each(t,function(e){a[t[e][1]]=t[e][0]});var e=new google.visualization.DataTable;e.addColumn("string","resultType");e.addColumn("number","numberOfSubmissions");e.addRows([["Accepted",a["AC"]],["Partially Solved",a["PS"]],["Wrong Answer",a["WA"]],["Time Limit Exceeded",a["TLE"]],["Memory Limit Exceeded",a["MLE"]],["Runtime Error",a["RE"]],["Compile Error",a["CE"]],["Hacked",a["HCK"]],["Skipped",a["SK"]],["Others",a["OTH"]]]);var o={title:"Total Submissions",width:600,height:500,pieHole:.5,slices:{0:{color:"#4CAF50"},1:{color:"#8BC34A"},2:{color:"#F44336"},3:{color:"#3F51B5"},4:{color:"#03A9F4"},5:{color:"#9C27B0"},6:{color:"#FF9800"},7:{color:"#795548"},8:{color:"#FFEB3B"},9:{color:"#9E9E9E"}},pieResidueSliceLabel:"",pieResidueSliceColor:"transparent"};var r=new google.visualization.PieChart(document.getElementById("chart_div"));r.draw(e,o)}var m=function(){if(!canUpdate)return;f(document).on("click","#update-my-submissions",function(){var t=f(this);f.ajax({url:refreshNowURL,method:"POST",data:{stopstalk_handle:stopstalkHandle,custom:custom},success:function(e){if(e==="FAILURE"){f.web2py.flash("Something went wrong");return}canUpdate=false;t.addClass("disabled");if(custom==="True"){Materialize.toast("Custom user submissions will be updated in 20 minutes",8e3)}else{Materialize.toast("Your submissions will be updated in 5 minutes",8e3)}},error:function(e){f.web2py.flash("Something went wrong");console.log(e)}})})};var g=function(){if(totalSubmissions==="0"){return}var i=function(e,t,a){return problemIndexURL+"?"+f.param({problem_id:a})};var s=function(e,t,a,o){var r=e.clone(),n=r.children();n[0]["href"]=i(t,a,o);n[0].innerHTML=a;if(isLoggedIn){f(n[1]).attr("data-pid",o);return"<div class='todo-list-icon' style='display: inline-flex;'>"+n[0].outerHTML+n[1].outerHTML+"</div>"}else{return n[0].outerHTML}};var t=function(e,t){var o=e[t+"_problems"],r="<table class='bordered col offset-s1 s10' id='solved-unsolved-table'>",n=[f(f.parseHTML(e["solved_html_widget"])),f(f.parseHTML(e["unsolved_html_widget"])),f(f.parseHTML(e["unattempted_html_widget"]))];var a=["Dynamic Programming","Greedy","Strings","Hashing","Bit Manipulation","Trees","Graphs","Algorithms","Data Structures","Math","Implementation","Miscellaneous"];f.each(a,function(e,t){var a=o[t];if(a.length===0)return;r+="<tr>";r+="<td class='categories'><strong>"+t+"</strong> <strong class='purple-text text-darken-3 category-pcount'>"+a.length+"</strong></td><td> | ";f.each(a,function(e,t){r+=s(n[t[2]],t[0],t[1],t[3]);r+=" | "});r+="</td></tr>"});r+="</table>";return r};f.ajax({url:getSolvedUnsolvedURL,method:"GET",data:{user_id:userID,custom:custom},success:function(e){f("#solved-problems-list").html(t(e,"solved"));f("#unsolved-problems-list").html(t(e,"unsolved"))},error:function(e){console.log(e);f.web2py.flash("Something went wrong")}})};var v=function(){var t=0;f(document).keydown(function(e){switch(e.which){case 37:t=(t-1+4)%4;break;case 39:t=(t+1+4)%4;break;default:return}e.preventDefault()})};var b=function(){f("#friend-list-modal").modal();var e=f("#view-submission-preloader").clone();e.attr("id","friendsListThrobber");f("#friend-list").html(e);f(document).on("click","#friend-list-button",function(){var e=f(this);if(isLoggedIn){f("#friend-list-modal").modal("open");f.ajax({url:getFriendListUrl,method:"GET",data:{user_id:e.data("user-id")},success:function(e){f("#friend-list").html(e["table"])},error:function(e){f.web2py.flash("Something went wrong");f("#friend-list").html("Something went wrong!")}})}else{f.web2py.flash("Log in to see friend list.")}})};var y=function(e){if(custom==="True")return;var t=e===1?"problem":"problems";f("#problems-authored-count").html(e.toString()+" "+t+" authored by "+handle)};f(document).ready(function(){if(totalSubmissions!=="0"){e().then(function(e){y(e["problems_authored_count"]);a(e["solved_counts"]);f("#solved-problems").html(e["solved_problems_count"]);f("#total-problems").html(e["total_problems_count"]);f("#curr-streak").html(e["curr_day_streak"]);f("#max-streak").html(e["max_day_streak"]);f("#curr-accepted-streak").html(e["curr_accepted_streak"]);f("#max-accepted-streak").html(e["max_accepted_streak"]);o(e["site_accuracies"]);t.userStats.rating_history=e["rating_history"];t.userStats.calendar_data=e["calendar_data"];t.userStats.status_percentages=e["status_percentages"];google.load("visualization","1.1",{packages:["corechart","calendar","bar"],callback:r})})}else{f("#user-details").css("margin-left","32%")}f("#stopstalk-handle").modal();f("#profile-add-to-my-custom-friend").click(function(){f("#stopstalk-handle").modal("open")});f("#custom-users-modal").modal();f(".custom-user-count-profile-page").click(function(){var e=f(this);f("#custom-users-modal").modal("open");if(f("#custom-users-list").html()===""){f.ajax({url:getCustomUserURL,method:"GET",data:{stopstalk_handle:e.data("stopstalk-handle")},success:function(e){f("#custom-users-list").html(e["content"])},error:function(e){f.web2py.flash("Something went wrong")}})}});b();g();setEditorialVoteEventListeners();f.ajax({url:handleDetailsURL,data:{handle:handle}}).done(function(e){var o={"invalid-handle":"Invalid handle","pending-retrieval":"Pending retrieval","not-provided":"Not provided"};f.each(e,function(e,t){var a=f("#"+e+"_chip");a.addClass(t);a.parent().attr("data-tooltip",o[t])});f(".tooltipped").tooltip({delay:50})});m();f(document).on("click",".profile-page-site-profile-url",function(e){var t=f(this),a=t[0]["href"];window.open(a,"_blank");e.preventDefault()});f(document).on("click",".friends-button",function(){var a=f(this),e=a.attr("data-user-id"),t=a.attr("data-type"),o=f(a.children()[0]);if(t=="add-friend"){if(isLoggedIn){a.removeClass("green");a.addClass("black");a.attr("data-type","unfriend");a.attr("data-tooltip","Unfriend");o.removeClass("fa-user-plus");o.addClass("fa-user-times");f.ajax({method:"POST",url:"/default/mark_friend/"+e}).done(function(e){f(".tooltipped").tooltip();f.web2py.flash(e)}).error(function(e,t){a.removeClass("black");a.addClass("green");a.attr("data-type","add-friend");a.attr("data-tooltip","Add friend");f.web2py.flash("["+e.status+"]: Unexpected error occurred")})}else{f.web2py.flash("Login to add friend")}}else if(t=="unfriend"){a.removeClass("black");a.addClass("green");a.attr("data-type","add-friend");a.attr("data-tooltip","Add friend");o.removeClass("fa-user-times");o.addClass("fa-user-plus");f.ajax({method:"POST",url:"/default/unfriend/"+e}).done(function(e){f(".tooltipped").tooltip();f.web2py.flash(e)}).error(function(e,t){f.web2py.flash("["+e.status+"]: Unexpected error occurred");f.web2py.flash("Unexpected error occurred")})}})})})(jQuery);